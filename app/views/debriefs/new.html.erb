<div class="h-full bg-gray-900 flex flex-col overflow-hidden" style="padding-bottom: env(safe-area-inset-bottom);" data-controller="recorder push">
  <!-- Header -->
  <header class="flex-shrink-0 flex items-center justify-between px-3 py-3">
    <%= link_to debriefs_path, class: "w-14 h-14 flex items-center justify-center rounded-2xl bg-gray-800 text-gray-300 hover:text-white hover:bg-gray-700 active:bg-gray-600 transition-colors" do %>
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
      </svg>
    <% end %>
    <div class="text-center">
      <h1 class="text-white font-medium text-lg">Debrief</h1>
      <% if current_user.present? %>
        <span class="text-blue-400 text-sm"><%= current_user.name %></span>
      <% end %>
    </div>
    <%= button_to session_path, method: :delete, class: "w-14 h-14 flex items-center justify-center rounded-2xl bg-gray-800 text-gray-300 hover:text-white hover:bg-gray-700 active:bg-gray-600 transition-colors" do %>
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
      </svg>
    <% end %>
  </header>

  <!-- Main content -->
  <main class="flex-1 flex flex-col items-center pt-8 px-8 overflow-hidden">
    <!-- Mode Toggle -->
    <div class="flex gap-1 mb-8 bg-gray-800 rounded-lg p-1">
      <button
        type="button"
        data-action="click->recorder#selectMode"
        data-mode="audio"
        data-recorder-target="modeToggle"
        class="px-4 py-2 rounded-md text-sm font-medium transition-all bg-gray-700 text-white"
      >
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
          </svg>
          Record
        </span>
      </button>
      <button
        type="button"
        data-action="click->recorder#selectMode"
        data-mode="text"
        data-recorder-target="modeToggle"
        class="px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-400"
      >
        <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          Write
        </span>
      </button>
    </div>

    <!-- AUDIO SECTION -->
    <div data-recorder-target="recordSection">
      <!-- Timer -->
      <div class="text-6xl font-mono text-white mb-12 text-center" data-recorder-target="timer">
        00:00
      </div>

      <!-- Idle state: Record button -->
      <div class="flex justify-center">
        <button
          type="button"
          data-action="click->recorder#start"
          data-recorder-target="idleButton"
          class="w-32 h-32 rounded-full bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-4 focus:ring-red-500/50 transition-all flex items-center justify-center"
        >
          <div class="w-12 h-12 rounded-full bg-white"></div>
        </button>
      </div>

      <!-- Recording state: Stop button -->
      <div class="flex justify-center">
        <button
          type="button"
          data-action="click->recorder#stop"
          data-recorder-target="recordingButton"
          class="hidden w-32 h-32 rounded-full bg-red-600 animate-pulse focus:outline-none focus:ring-4 focus:ring-red-500/50 transition-all flex items-center justify-center"
        >
          <div class="w-10 h-10 rounded-sm bg-white"></div>
        </button>
      </div>

      <!-- Preview state: Cancel and Send -->
      <div data-recorder-target="previewButtons" class="hidden flex justify-center gap-8">
        <button
          type="button"
          data-action="click->recorder#cancel"
          class="w-24 h-24 rounded-full bg-gray-600 hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-500/50 transition-all flex items-center justify-center"
        >
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <button
          type="button"
          data-action="click->recorder#send"
          class="w-24 h-24 rounded-full bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-500/50 transition-all flex items-center justify-center"
        >
          <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- TEXT SECTION (hidden by default) -->
    <div data-recorder-target="textSection" class="hidden w-full max-w-md">
      <textarea
        data-recorder-target="textInput"
        placeholder="Type your message..."
        rows="5"
        class="w-full bg-gray-800 text-white rounded-lg p-4 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-500"
      ></textarea>

      <!-- Attachments -->
      <div class="mt-4">
        <input
          type="file"
          data-recorder-target="fileInput"
          data-action="change->recorder#filesSelected"
          multiple
          accept="image/*,.pdf,.txt,.md,.csv,.doc,.docx,.xls,.xlsx"
          class="hidden"
        >
        <button
          type="button"
          data-action="click->recorder#openFilePicker"
          class="flex items-center gap-2 text-gray-400 hover:text-white text-sm transition-colors"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
          </svg>
          Attach files
        </button>

        <!-- File preview list -->
        <div data-recorder-target="filePreview" class="mt-3 space-y-2"></div>
      </div>

      <!-- Text buttons -->
      <div data-recorder-target="textButtons" class="flex justify-center gap-8 mt-6">
        <button
          type="button"
          data-action="click->recorder#cancelText"
          class="w-16 h-16 rounded-full bg-gray-600 hover:bg-gray-500 focus:outline-none focus:ring-4 focus:ring-gray-500/50 transition-all flex items-center justify-center"
        >
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <button
          type="button"
          data-action="click->recorder#sendText"
          class="w-16 h-16 rounded-full bg-green-500 hover:bg-green-600 focus:outline-none focus:ring-4 focus:ring-green-500/50 transition-all flex items-center justify-center"
        >
          <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Status -->
    <p class="mt-8 text-gray-400" data-recorder-target="status">
      Tap to record
    </p>

    <!-- Push notification status -->
    <div class="mt-8">
      <button
        type="button"
        data-action="click->push#requestPermission"
        data-push-target="button"
        class="text-sm text-gray-500 hover:text-gray-300 flex items-center gap-2 transition-opacity"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
        </svg>
        <span data-push-target="status">Enable notifications</span>
      </button>
    </div>
  </main>
</div>
